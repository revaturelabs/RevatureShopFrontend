
parameters:
  - name: 'aksConnection'
    type: string
    default: 'k8s-team3-config-dev'
  - name: 'releaseName'
    type: string
  - name: 'nameSpace'
    type: string
  - name: 'chartName'
    type: string
  - name: 'overrides'
    type: string
    default: ''

steps:
  - task: HelmDeploy@0
    displayName: Package Helm Chart
    inputs:
      command: 'package'
      chartPath: './${{ parameters.chartName }}/'
      destination: './helm/'

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: './helm/'
      artifact: '${{ parameters.chartName }}-package'
      publishLocation: 'pipeline'
    displayName: Publish Pipeline Artifact
  
  - task: HelmDeploy@0
    displayName: Helm Deploy to AKS
    inputs:
      connectionType: 'Kubernetes Service Connection'
      kubernetesServiceConnection: ${{ parameters.aksConnection }}
      command: 'upgrade'
      arguments: '--install --atomic --reuse-values'
      releaseName: ${{ parameters.releaseName }}
      namespace: ${{ parameters.nameSpace }}
      chartType: 'FilePath'
      chartPath: './swag-chart/'
      valueFile: './swag-chart/values.yaml'
      overrideValues: ${{ parameters.overrides }}
